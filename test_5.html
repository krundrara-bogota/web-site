<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Ciudad tipo Infinitown - Mapa Fijo</title>
  <style>
    body { margin: 0; overflow: hidden; background: #aee1f9; font-family: sans-serif; }
    #infoBox {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 12px 15px;
      border-radius: 6px;
      display: none;
      max-width: 300px;
    }
    #infoBox video {
      width: 100%;
      margin-top: 8px;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div id="infoBox"></div>

  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.165.0/build/three.module.js",
        "OrbitControls": "https://unpkg.com/three@0.165.0/examples/jsm/controls/OrbitControls.js"
      }
    }
  </script>

  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'OrbitControls';

    // Escena y cámara
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xaee1f9);

    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(20, 20, 20);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.target.set(10, 0, 10);
    controls.update();

    // Luz
    scene.add(new THREE.AmbientLight(0xffffff, 0.6));
    const sun = new THREE.DirectionalLight(0xffffff, 1);
    sun.position.set(20, 30, 10);
    scene.add(sun);

    // Suelo
    const groundGeo = new THREE.PlaneGeometry(60, 60);
    const groundMat = new THREE.MeshLambertMaterial({ color: 0x88c070 });
    const ground = new THREE.Mesh(groundGeo, groundMat);
    ground.rotation.x = -Math.PI / 2;
    scene.add(ground);

    // Crear cuadrícula de calles
    const streetMat = new THREE.MeshLambertMaterial({ color: 0x333333 });
    for (let i = -25; i <= 25; i += 10) {
      const streetH = new THREE.Mesh(new THREE.BoxGeometry(60, 0.1, 3), streetMat);
      streetH.position.set(0, 0.05, i);
      scene.add(streetH);

      const streetV = new THREE.Mesh(new THREE.BoxGeometry(3, 0.1, 60), streetMat);
      streetV.position.set(i, 0.05, 0);
      scene.add(streetV);
    }

    // Colores base
    const colors = [0xf5b7b1, 0xf9e79f, 0x82e0aa, 0x85c1e9, 0xbb8fce];

    // Datos de edificios con información
    const buildingInfo = {
      ayuntamiento: {
        name: "Ayuntamiento",
        description: "Centro administrativo de la ciudad.",
        video: "https://www.w3schools.com/html/mov_bbb.mp4"
      },
      museo: {
        name: "Museo de Arte Moderno",
        description: "Exposición de arte y cultura local.",
        video: "https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"
      },
      cafeteria: {
        name: "Cafetería Central",
        description: "El mejor café y pasteles de la ciudad.",
        video: "https://www.w3schools.com/html/movie.mp4"
      }
    };

    // Crear edificios fijos (mapa 5x5)
    const buildings = [];
    const size = 5; // cantidad de filas/columnas
    const spacing = 10;

    for (let x = 0; x < size; x++) {
      for (let z = 0; z < size; z++) {
        const posX = x * spacing - 20;
        const posZ = z * spacing - 20;

        const height = 2 + Math.random() * 6;
        const color = new THREE.Color(colors[Math.floor(Math.random() * colors.length)]);
        const buildingMat = new THREE.MeshLambertMaterial({ color });

        const buildingGeo = new THREE.BoxGeometry(3 + Math.random() * 2, height, 3 + Math.random() * 2);
        const building = new THREE.Mesh(buildingGeo, buildingMat);
        building.position.set(posX, height / 2, posZ);

        // Algunos edificios tendrán información (3 puntos fijos)
        if (x === 2 && z === 1) building.userData = buildingInfo.ayuntamiento;
        else if (x === 3 && z === 3) building.userData = buildingInfo.museo;
        else if (x === 1 && z === 4) building.userData = buildingInfo.cafeteria;

        scene.add(building);
        buildings.push(building);
      }
    }

    // Interacción (clic)
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();
    const infoBox = document.getElementById('infoBox');

    window.addEventListener('click', (event) => {
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObjects(buildings);

      if (intersects.length > 0) {
        const b = intersects[0].object;
        if (b.userData && b.userData.name) {
          const { name, description, video } = b.userData;
          infoBox.style.display = 'block';
          infoBox.innerHTML = `
            <strong>${name}</strong><br>
            ${description}<br>
            <video src="${video}" controls autoplay muted loop></video>
          `;
          return;
        }
      }
      infoBox.style.display = 'none';
    });

    // Responsividad
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // Animación
    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
